<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>circelcuanmv – Hapus Paket</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <!-- Tambahkan CDN SweetAlert2 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"/>
  <style>
    :root{--primary:#005eff;--dark:#121212;--darker:#1e1e1e;--card:#2d2d2d;--text:#e0e0e0}
    body{background:var(--dark);color:var(--text);font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;min-height:100vh;padding-bottom:3rem}
    .container{max-width:500px;margin-top:2rem}
    .card{background:var(--card);border:none;border-radius:12px;box-shadow:0 8px 16px rgba(0,0,0,.2)}
    .card-header{background:linear-gradient(135deg,var(--primary),#004cd4);color:#fff;font-weight:600}
    .form-control,.form-select{background:var(--darker);color:var(--text);border:1px solid #444;border-radius:10px}
    .btn-primary,.btn-danger{border:none;border-radius:10px;font-weight:600}
    .btn-primary{background:linear-gradient(135deg,var(--primary),#004cd4)}
    .btn-danger{background:#dc3545}
    .loading-spinner{display:inline-block;width:1rem;height:1rem;border:2px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;animation:spin 1s linear infinite;margin-right:8px}
    @keyframes spin{to{transform:rotate(360deg)}}
    .alert{border-radius:10px;border:none}
    .text-muted {
      color: #ffffff !important;
    }
    .form-label {
      color: #ffffff !important;
    }
    .form-control {
      background-color: #ffffff !important;
      color: #333333 !important;
      border: 1px solid #cccccc !important;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="text-center mb-3">
      <p class="text-muted">Pilih paket yang ingin Anda hapus dari nomor XL/AXIS</p>
    </div>

    <div class="card">
      <div class="card-header text-center"><h5 class="mb-0"><i class="fas fa-clipboard-list me-2"></i>Hapus Paket xl/axis</h5></div>
      <div class="card-body">
        <form id="getPackagesForm">
          <div class="mb-3">
            <label for="nomor" class="form-label">Nomor HP</label>
            <input type="text" id="nomor" class="form-control" placeholder="0877" required/>
          </div>
          <button type="submit" id="getBtn" class="btn btn-primary w-100"><i class="fas fa-search me-2"></i>Cari Paket</button>
        </form>

        <div id="responseMessage" class="alert mt-3" style="display:none"><pre id="resultText" class="mb-0"></pre></div>

        <form id="deletePackageForm" class="mt-4" style="display:none">
          <div class="mb-3">
            <label for="paketSelect" class="form-label">Pilih Paket</label>
            <select id="paketSelect" class="form-select" required></select>
          </div>
          <button type="submit" id="delBtn" class="btn btn-danger w-100"><i class="fas fa-trash me-2"></i>Hapus Paket</button>
        </form>
      </div>
    </div>
  </div>
  <br>
  <div class="footer">
    © 2025 FSTORE INC | 
    <i class="fas fa-code"></i> by 
    <i class="fas fa-heart" style="color: #005eff;"></i> circelcuanmv 
  </div> 
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    const API_BASE='https://apsapi.biz.id';
    const TOKEN='Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImFAYS5hYSIsImlhdCI6MTc1NDU2MDc0OSwiZXhwIjoxNzU3MTUyNzQ5fQ.LexNiBxFCSZnq-nA05n4qKQfsfFh7NQKOb51gQEfPoE';
    const getPackagesForm=document.getElementById('getPackagesForm');
    const deletePackageForm=document.getElementById('deletePackageForm');
    const responseDiv=document.getElementById('responseMessage');
    const resultText=document.getElementById('resultText');
    const paketSelect=document.getElementById('paketSelect');
    const getBtn=document.getElementById('getBtn');
    const delBtn=document.getElementById('delBtn');
    let packages=[];

    getPackagesForm.addEventListener('submit', async e => {
      e.preventDefault();
      let nomor = document.getElementById('nomor').value.trim();
      nomor = nomor.replace(/[-\s]/g, '');
      if (nomor.startsWith('+628')) {
        nomor = '628' + nomor.slice(4);
      }
      if (!/^(08|628)\d{8,11}$/.test(nomor)) {
        showResult('❌ Nomor harus diawali 08, 628, atau +628 dan total 10-13 digit.', 'danger');
        return;
      }
      if (nomor.startsWith('628')) {
        nomor = '08' + nomor.slice(3);
      }
      toggleBtn(getBtn, true, 'Cari Paket');
      hideResult();
      try {
        const res = await fetch(`${API_BASE}/pdp`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': TOKEN },
          body: JSON.stringify({ nomor })
        });
        const json = await res.json();
        if (!json.quota?.length) throw new Error('Tidak ada paket aktif.');
        packages = json.quota;
        populatePaketSelect(packages);
        deletePackageForm.style.display = 'block';
        showResult('✅ Paket ditemukan.', 'success');
        autoHideResult(2000);
      } catch (err) {
        showResult('❌ ' + err.message, 'danger');
      } finally {
        toggleBtn(getBtn, false, 'Cari Paket');
      }
    });

    deletePackageForm.addEventListener('submit', async e => {
      e.preventDefault();
      const idx = paketSelect.selectedIndex;
      const pkg = packages[idx];
      if (!pkg) return;

      // Tampilkan SweetAlert2 untuk konfirmasi
      const result = await Swal.fire({
        title: 'Konfirmasi Hapus',
        text: `Apakah Anda yakin ingin menghapus paket "${pkg.name}"?`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#dc3545',
        cancelButtonColor: '#6c757d',
        confirmButtonText: 'Ya, Hapus',
        cancelButtonText: 'Batal',
        reverseButtons: true
      });

      if (!result.isConfirmed) return; // Jika pengguna membatalkan, hentikan proses

      // Bersihkan nomor sebelum dikirim ke API
      let nomor = document.getElementById('nomor').value.trim();
      nomor = nomor.replace(/[-\s]/g, '');
      if (nomor.startsWith('+628')) {
        nomor = '628' + nomor.slice(4);
      }
      if (nomor.startsWith('628')) {
        nomor = '08' + nomor.slice(3);
      }

      toggleBtn(delBtn, true, 'Hapus Paket');
      try {
        const res = await fetch(`${API_BASE}/delete`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': TOKEN },
          body: JSON.stringify({ nomor, nama: pkg.name, paket: pkg.package })
        });
        const json = await res.json();
        if (json.success) {
          showResult(`✅ ${json.paket}`, 'success');
          autoHideResult(2000);
          packages.splice(idx, 1);
          populatePaketSelect(packages);
          if (!packages.length) deletePackageForm.style.display = 'none';
        } else {
          throw new Error(json.message || 'Gagal menghapus.');
        }
      } catch (err) {
        showResult('❌ ' + err.message, 'danger');
      } finally {
        toggleBtn(delBtn, false, 'Hapus Paket');
      }
    });

    function populatePaketSelect(list) {
      paketSelect.innerHTML = '';
      list.forEach(p => {
        const opt = document.createElement('option');
        opt.value = p.package;
        opt.textContent = `${p.name} (berakhir ${p.expired_at})`;
        paketSelect.appendChild(opt);
      });
    }
    function showResult(msg, type) {
      resultText.textContent = msg;
      responseDiv.className = `alert alert-${type}`;
      responseDiv.style.display = 'block';
    }
    function hideResult() {
      responseDiv.style.display = 'none';
    }
    function autoHideResult(ms) {
      setTimeout(hideResult, ms);
    }
    function toggleBtn(btn, loading, label) {
      if (loading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading-spinner"></span>Memproses...';
      } else {
        btn.disabled = false;
        btn.innerHTML = `<i class="fas fa-${label === 'Cari Paket' ? 'search' : 'trash'} me-2"></i>${label}`;
      }
    }
  </script>
</body>
</html></html>
<br>
            <div id="response"></div>
            <br>
            <center>
				
                Modified By ~circelcuanmv ~<br/>
      Copyright © 2025 MV Store
                
            </center>
